{% extends "base.html" %}
{% load static %}


{% block content %}
<head>
    <meta charset='utf-8'>
    <meta http-equiv='X-UA-Compatible' content='IE=edge'>
    <title>MyChat</title>
    <meta name='viewport' content='width=device-width, initial-scale=1'>
     <script src="{% static 'agora/js/streams.js' %}"></script>
    <link rel='stylesheet' type='text/css' media='screen' href= "{% static 'agora/CSS/main.css'%}">
</head>

    <main>
        <section id="form-container">
       

            <div id="welcome-message">
            <h2> Group video call</h2>
            </div>

            <form id="form">
             
                <div class="form-field">
                    <label>Room</label>
                    <input type="text" name="room" placeholder="Enter room name..."/>
                </div>

                <div class="form-field">
                    <label>Name</label>
                    <input type="text" name="room" placeholder="Enter your nickname..."/>
                </div>

                <div class="form-field">
                    <input type="submit"  value="Join Room">
                    <p> </p>
                    <a role="button" href="{% url "index" %}">Back to rooms</a>
                </div>
            </form>
        </section>
    </main>
    <script>
    let form = document.getElementById('form')

    let handleSubmit = async (e) => {
        e.preventDefault()
        let room = e.target.room.value.toUpperCase()
        let name = e.target.name.value

        let response = await fetch(`/get_token/?channel=${room}`)
        let data = await response.json()

        let UID = data.uid
        let token = data.token

        sessionStorage.setItem('UID', UID)
        sessionStorage.setItem('token', token)
        sessionStorage.setItem('room', room)
        sessionStorage.setItem('name', name)

        window.open('/room/', '_self')
    }



    form.addEventListener('submit', handleSubmit)
</script>

</body>
{% endblock %}